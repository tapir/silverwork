---
# yaml-language-server: $schema=https://schema.blue-build.org/module-list-v1.json
modules:
  - type: script
    snippets:
    - |
      sed -i '/^\[fedora\]/a exclude=akmods' /etc/yum.repos.d/fedora.repo
      sed -i '/^\[updates\]/a exclude=akmods' /etc/yum.repos.d/fedora-updates.repo
      mv /usr/lib/kernel/install.d/05-rpmostree.install /usr/lib/kernel/install.d/05-rpmostree.install.bak
      mv /usr/lib/kernel/install.d/50-dracut.install /usr/lib/kernel/install.d/50-dracut.install.bak
      printf '%s\n' '#!/bin/sh' 'exit 0' > /usr/lib/kernel/install.d/05-rpmostree.install
      printf '%s\n' '#!/bin/sh' 'exit 0' > /usr/lib/kernel/install.d/50-dracut.install
      chmod +x  /usr/lib/kernel/install.d/05-rpmostree.install /usr/lib/kernel/install.d/50-dracut.install

  - type: dnf
    repos:
      cleanup: true
      copr:
        - bieszczaders/kernel-cachyos-lto
    remove:
      auto-remove: false
      packages:
        - kernel
        - kernel-core
        - kernel-modules
        - kernel-modules-core
        - kernel-modules-extra
        - kernel-devel
        - kernel-devel-matched
    install:
      skip-unavailable: true
      packages:
        - kernel-cachyos-lto
        - kernel-cachyos-lto-core
        - kernel-cachyos-lto-modules
        - kernel-cachyos-lto-devel-matched

  - type: script
    snippets:
    - |
      mv -f /usr/lib/kernel/install.d/05-rpmostree.install.bak /usr/lib/kernel/install.d/05-rpmostree.install
      mv -f /usr/lib/kernel/install.d/50-dracut.install.bak /usr/lib/kernel/install.d/50-dracut.install 

  - type: dnf
    repos:
      cleanup: true
      copr:
        - bieszczaders/kernel-cachyos-addons
    remove:
      packages:
        - zram-generator-defaults
    install:
      skip-unavailable: true
      packages:
        - cachyos-settings
        - scx-scheds
        - scx-tools

  - type: script
    snippets:
      - "rm /usr/bin/game-performance"